name: éƒ¨ç½²åˆ°Fly.io

on:
  push:
    tags:
      - 'v*'  # åŒ¹é…æ‰€æœ‰ä»¥vå¼€å¤´çš„æ ‡ç­¾ï¼Œä¾‹å¦‚v1.0.0

jobs:
  deploy:
    name: éƒ¨ç½²åº”ç”¨
    runs-on: ubuntu-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      - name: æ£€æŸ¥å¹¶ä¿®å¤.dockerignoreæ–‡ä»¶
        run: |
          if [ -f .dockerignore ]; then
            echo "æ£€æŸ¥.dockerignoreæ–‡ä»¶æ ¼å¼..."
            # å°†Windowsé£æ ¼çš„è·¯å¾„åˆ†éš”ç¬¦(\)æ›¿æ¢ä¸ºLinuxé£æ ¼(/)
            sed -i 's/\\\*/\/*/g' .dockerignore
            echo "ä¿®å¤åçš„.dockerignoreå†…å®¹:"
            cat .dockerignore
          fi
      
      - name: è®¾ç½®Flyctl
        uses: superfly/flyctl-actions/setup-flyctl@master
      
      - name: éƒ¨ç½²åˆ°Fly.io
        run: flyctl deploy --remote-only
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
          
      - name: åº”ç”¨éƒ¨ç½²é€šçŸ¥
        run: |
          echo "ğŸš€ åº”ç”¨ ${{ github.repository }} å·²æˆåŠŸéƒ¨ç½²åˆ° Fly.io"
          echo "æ ‡ç­¾: ${{ github.ref_name }}"
          echo "URL: https://betalyr-learning-server.fly.dev" 